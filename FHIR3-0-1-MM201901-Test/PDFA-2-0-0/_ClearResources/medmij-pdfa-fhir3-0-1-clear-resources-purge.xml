<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir">
	<id value="medmij-pdfa-fhir3-0-1-clear-resources-purge-xml"/>
	<url value="http://nictiz.nl/fhir/fhir3-0-1/TestScript/medmij-pdfa-fhir3-0-1-clear-resources-purge-xml"/>
	<name value="Nictiz MedMij PDFA - Clear Test Resources - Delete - XML"/>
	<status value="active"/>
	<date value="2019-07-11"/>
	<publisher value="Nictiz"/>
	<contact>
		<name value="Nictiz"/>
		<telecom>
			<system value="email"/>
			<value value="kwalificatie@nictiz.nl"/>
			<use value="work"/>
		</telecom>
	</contact>
	<description value="Delete MedMij PDFA test resources using the $purge operation of the target FHIR server for use in PDFA qualification testing."/>
	<copyright value="Â© Nictiz 2019"/>
    <fixture id="patient1-token">
        <resource>
        	<reference value="../_reference/resources/medmij-pdfa-fhir3-0-1-Patient-Token-kwalificatie1.xml"/>
        </resource>
    </fixture>
	<fixture id="patient2-token">
		<resource>
			<reference value="../_reference/resources/medmij-pdfa-fhir3-0-1-Patient-Token-kwalificatie2.xml"/>
		</resource>
	</fixture>
	<fixture id="patient3-token">
		<resource>
			<reference value="../_reference/resources/medmij-pdfa-fhir3-0-1-Patient-Token-kwalificatie3.xml"/>
		</resource>
	</fixture>
	
    <variable>
        <name value="patient1"/>
        <expression value="Patient.id"/>
        <sourceId value="patient1-token"/>
    </variable>
    <variable>
        <name value="patient2"/>
        <expression value="Patient.id"/>
        <sourceId value="patient2-token"/>
    </variable>
	<variable>
		<name value="patient3"/>
		<expression value="Patient.id"/>
		<sourceId value="patient3-token"/>
	</variable>
	
	<!-- No Setup -->
	<test id="Step1-ClearTestResourceDelete">
		<name value="Step1-ClearTestResourceDelete"/>
		<description value="Delete MedMij PDFA test resources using the $purge operation of the target FHIR server for use in PDFA qualification testing."/>
		<action>
			<operation>
				<type>
					<system value="http://touchstone.com/fhir/extended-operation-codes"/>
					<code value="purge"/>
				</type>
				<resource value="Patient"/>
				<accept value="xml"/>
				<contentType value="xml"/>
				<params value="/$purge"/>
				<requestHeader>
					<field value="Authorization"/>
					<value value="${patient1}"/>
				</requestHeader>
			</operation>
		</action>
		<action>
			<assert>
				<description value="Confirm that the returned HTTP status is 200(OK)."/>
				<operator value="equals"/>
				<responseCode value="200"/>
			</assert>
		</action>
		<action>
			<operation>
				<type>
					<system value="http://touchstone.com/fhir/extended-operation-codes"/>
					<code value="purge"/>
				</type>
				<resource value="Patient"/>
				<accept value="xml"/>
				<contentType value="xml"/>
				<params value="/$purge"/>
				<requestHeader>
					<field value="Authorization"/>
					<value value="${patient2}"/>
				</requestHeader>
			</operation>
		</action>
		<action>
			<assert>
				<description value="Confirm that the returned HTTP status is 200(OK)."/>
				<operator value="equals"/>
				<responseCode value="200"/>
			</assert>
		</action>
		<action>
			<operation>
				<type>
					<system value="http://touchstone.com/fhir/extended-operation-codes"/>
					<code value="purge"/>
				</type>
				<resource value="Patient"/>
				<accept value="xml"/>
				<contentType value="xml"/>
				<params value="/$purge"/>
				<requestHeader>
					<field value="Authorization"/>
					<value value="${patient3}"/>
				</requestHeader>
			</operation>
		</action>
	</test>
</TestScript>