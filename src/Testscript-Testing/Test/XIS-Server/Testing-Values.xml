<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://hl7.org/fhir/STU3/testscript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript"
    nts:scenario="server">
    <id value="Testing-Values"/>
    <version value="stu3-2.0"/>
    <name
        value="Testing-Values - XIS Server - Scenario 1.1 - Check if values are conform the testscript"/>
    <description value="Scenario 1.1 - Testing if values are conform the testscript"/>
    <nts:patientTokenFixture href="medmij-bgz-ext-nl-core-patient-01-token.xml"/>

    <test id="Basic-tests">
        <name value="1.1 Basic-tests"/>
        <description value="Check if Identifier structure is correct"/>
        <action>
            <operation>
                <type>
                    <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Observation"/>
                <description value="Test XIS server to serve Observation resources."/>
                <accept value="xml"/>
                <destination value="1"/>
                <encodeRequestUrl value="true"/>
                <origin value="1"/>
                <params value="?code=http://loinc.org|8302-2"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${patient-token-id}"/>
                </requestHeader>
                <requestHeader>
                    <field value="MedMij-Request-ID"/>
                    <value value="${UUID}"/>
                </requestHeader>
                <responseId value="search-observation"/>
            </operation>
        </action>
        <nts:include value="assert.response.numResources" scope="common" 
            resource="Observation" count="1"/>
    </test>

    <test id="status">
        <name value="1.2 status"/>
        <description value="Check if status contains the correct value"/>
        <action>
            <assert>
                <description value="Confirm that the status contains the expected value"/>
                <direction value="response"/>
                <expression value="Bundle.entry.resource.status = 'final'"/>
                <sourceId value="search-observation"/>
            </assert>
        </action>
    </test>
</TestScript>
