<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../../general/schematron/NictizTestScript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!--
    Test an MP9 scenario
    @param scenarioset
    @param scenario
    @param buildingBlockEN
    @param buildingBlockNL
    @param resourceType
    @param scenarioDescription
    @param scenarioPatient
    @param scenarioDateT
    @param scenarioParams
    @param returnCount
    @param returnEntryCount
    @param reutrnEntryBreakdown
-->
<nts:component xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
    <nts:parameter name="scenarioDateT" value="no"/>
    
    <id value="mp9-{$buildingBlockEN}-retrieve-{$scenarioset}-{$scenario}"/>
    <version value="r4-mp9-2.0.0"/>
    <name value="Medication Process 9 2.0.0  - {$buildingBlockEN} (NL: {$buildingBlockNL}) - Retrieve - Scenario {$scenarioset}.{$scenario}"/>
    <description value="Scenario {$scenarioset}.{$scenario} - {$scenarioDescription}"/>
    <!--<nts:patientTokenFixture href="nl-core-Patient-mp9-{$scenarioPatient}-token.xml"/>-->
    <nts:includeDateT value="{$scenarioDateT}"/>
    
    <test id="Scenario-{$scenarioset}-{$scenario}">
        <name value="Scenario {$scenarioset}.{$scenario}"/>
        <description value="{$scenarioDescription}"/>
        <nts:include value="operation-search">
            <nts:with-parameter name="description" value="Query {$resourceType} resource(s) for {$buildingBlockEN}"/>
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="params" value="{$scenarioParams}"/>
        </nts:include>
        <nts:include value="canary-assert.response.successfulSearch" scope="common"/>
        <nts:include value="assert-returnCount" scope="project">
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="count" value="{$returnCount}"/>
        </nts:include>
        <nts:include value="assert-returnEntryCountAtLeast" scope="project">
            <nts:with-parameter name="count" value="{$returnEntryCount}"/>
            <nts:with-parameter name="breakdown" value="{$returnEntryBreakdown}"/>
        </nts:include>
    </test>
</nts:component>