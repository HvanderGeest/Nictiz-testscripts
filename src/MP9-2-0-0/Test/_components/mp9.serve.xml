<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../../general/schematron/NictizTestScript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<!--
    Test an MP9 'serve' scenario
    @param scenarioset
    @param scenario
    @param buildingBlockEN
    @param buildingBlockNL
    @param resourceType
    @param scenarioDescription
    @param scenarioPatient
    @param scenarioDateT
    @param scenarioParams
    @param returnCount
    @param returnEntryCount
    @param returnEntryBreakdown
    @param medicationCode
    @param medicationSystem
    @param resourcesAtLeast
-->
<nts:component xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
    <nts:parameter name="scenarioDateT" value="no"/>
    
    <id value="mp9-{$buildingBlockEN}-serve-{$scenarioset}-{$scenario}"/>
    <version value="r4-mp9-2.0.0"/>
    <name value="Medication Process 9 2.0.0  - {$buildingBlockEN} (NL: {$buildingBlockNL}) - Serve - Scenario {$scenarioset}.{$scenario}"/>
    <description value="Scenario {$scenarioset}.{$scenario} - {$scenarioDescription}"/>
    <nts:includeDateT value="{$scenarioDateT}"/>
    
    <test id="Scenario-{$scenarioset}-{$scenario}">
        <name value="Scenario {$scenarioset}.{$scenario}"/>
        <description value="{$scenarioDescription}"/>
        <nts:include value="operation-search">
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="description" value="Test server to serve {$resourceType} resource(s) for {$buildingBlockEN}"/>
            <nts:with-parameter name="params" value="{$scenarioParams}"/>
        </nts:include>
        <nts:include value="assert.response.successfulSearch" scope="common"/>
        <nts:include value="mp9.assert.checkExtensions"/>
        <nts:include nts:ifset="resourcesAtLeast" value="assert.response.numResources" scope="common" atLeast="true">
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="count" value="{$returnCount}"/>
        </nts:include>
        <nts:include nts:ifnotset="resourcesAtLeast" value="assert.response.numResources" scope="common">
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="count" value="{$returnCount}"/>
        </nts:include>
        <nts:include value="assert.response.numEntries" scope="project" atLeast="true">
            <nts:with-parameter name="resource" value="{$resourceType}"/>
            <nts:with-parameter name="count" value="{$returnEntryCount}"/>
            <nts:with-parameter name="additionalDescription" value="{$returnEntryBreakdown}"/>
        </nts:include>
        <nts:include nts:ifset="medicationCode" value="mp9.assert.response.resourceByMedication" scope="project"/>
    </test>
</nts:component>