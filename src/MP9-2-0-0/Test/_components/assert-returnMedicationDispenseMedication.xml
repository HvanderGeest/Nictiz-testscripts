<nts:component  xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
    <nts:parameter name="warningOnly" value="false"/>
    <action>
        <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
                <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains the MedicationDispense resource for this specific subscenario."/>
            <direction value="response"/>
            <expression value="Bundle.entry.select(resource as MedicationDispense).medication.resolve().code.coding.where(code = '{$productCode}' and system = '{$productSystem}').exists()"/>
            <warningOnly value="{$warningOnly}"/>
        </assert>
    </action>
    <variable>
        <name value="scenario-resource-id"/>
        <description value="Resource.id of the focal resource of this subscenario, used by Nictiz for quality checks"/>
        <expression value="Bundle.entry.select(resource as MedicationDispense).where($this.medication.resolve().code.coding.where(code = '{$productCode}' and system = '{$productSystem}')).id"/>
        <sourceId value="searchset-response"/>
    </variable>
    <!--<action>
        <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
                <valueBoolean value="false"/>
            </extension>
            <description value="Mock assert, intended to show the Resource.id of the MedicationDispense resource, used for this specific subscenario, to the left."/>
            <direction value="response"/>
            <expression value="Bundle.entry.select(resource as MedicationDispense).where($this.id = '${scenario-resource-id}').id"/>
            <value value="${scenario-resource-id}"/>
            <warningOnly value="{$warningOnly}"/>
        </assert>
    </action>-->
    <action>
        <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
                <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains the Medication resource for this specific subscenario. Test: ${scenario-resource-id}"/>
            <direction value="response"/>
            <expression value="Bundle.entry.select(resource as Medication).code.coding.where(code = '{$productCode}' and system = '{$productSystem}').exists()"/>
            <warningOnly value="{$warningOnly}"/>
        </assert>
    </action>
</nts:component>