<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../../general/schematron/NictizTestScript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<nts:component xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
    
    <nts:profile id="Bundle-profile" value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
    <action>
        <assert>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="request"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that Bundle entries do not contain Nictiz extensions that are not defined in the MP9 and/or zib package."/>
            <direction value="request"/>
            <expression value="Bundle.descendants().ofType('Extension').url.where($this.startsWith('http://nictiz.nl/fhir/StructureDefinition/') and $this.substring(42).subsetOf('ext-AddressInformation.AddressType' | 'ext-AdministrationAgreement.AdditionalInformation' | 'ext-AdministrationAgreement.AdministrationAgreementDateTime' | 'ext-AdministrationAgreement.AgreementReason' | 'ext-AdvanceDirective.Disorder' | 'ext-AnatomicalLocation.Laterality' | 'ext-CarePlan-MaterialUsed' | 'ext-CodeSpecification' | 'ext-Comment' | 'ext-Context-EpisodeOfCare' | 'ext-CopyIndicator' | 'ext-DispenseRequest.AdditionalWishes' | 'ext-DispenseRequest.DispenseLocation' | 'ext-DispenseRequest.FinancialIndicationCode' | 'ext-EpisodeOfCare.EpisodeOfCareName' | 'ext-InstructionsForUse.RepeatPeriodCyclicalSchedule' | 'ext-LanguageProficiency.CommunicationDetails' | 'ext-MedicalDevice.HealthProfessional' | 'ext-MedicalDevice.Location' | 'ext-MedicationAdministration.AgreedAmount' | 'ext-MedicationAdministration.Category' | 'ext-MedicationAdministration2.AdministeringSpeedRange' | 'ext-MedicationAdministration2.AgreedDateTime' | 'ext-MedicationAdministration2.DeviatingAdministration' | 'ext-MedicationAdministration2.DoubleCheckPerformed' | 'ext-MedicationAdministration2.ReasonForDeviation' | 'ext-MedicationAgreement.MedicationAgreementAdditionalInformation' | 'ext-MedicationAgreement.RelationAdministrationAgreement' | 'ext-MedicationAgreement.RelationMedicationUse' | 'ext-MedicationDispense.Category' | 'ext-MedicationDispense.DistributionForm' | 'ext-MedicationDispense.MedicationDispenseAdditionalInformation' | 'ext-MedicationDispense.RequestDate' | 'ext-MedicationUse.Author' | 'ext-MedicationUse2.AsAgreedIndicator' | 'ext-MedicationUse2.Prescriber' | 'ext-NursingIntervention-ContributorIsRequester' | 'ext-PharmaceuticalProduct.Description' | 'ext-PharmaceuticalTreatment.Identifier' | 'ext-Problem.FurtherSpecificationProblemName' | 'ext-Procedure.ProcedureMethod' | 'ext-RenderedDosageInstruction' | 'ext-ResourceCategory' | 'ext-StopType' | 'ext-TimeInterval.Duration' | 'ext-TimeInterval.Period').not())"/>
            <warningOnly value="false"/>
        </assert>
    </action>
    
</nts:component>