<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://hl7.org/fhir/STU3/testscript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript"
    nts:scenario="client">
<!--    is dit client?
    heel erg medmij-centrisch, moet nog achterhaald worden of dit een probleem is voor ander standaarden
    voor nu op client laten staan: geen xml/json varianten omdat de client zelf mag weten wat ie stuurt-->
    
    <id value="xis-1-1-send-panel"/>
    <version value="R4-3.0"/>
    <name value="LaboratoryResults - LAB-LRS - Scenario 1.1 - Send a panel of laboratory results in LOINC."/>
    <description value="Scenario 1.1 - Send a panel of laboratory results in LOINC."/>
 
    <nts:fixture id="scenario-1-1-panel-fixture-LOINC"
        href="lr-slr-KWAL-KC-LOINC-Scenario1-KCLOINC1.xml"/>

    <test id="lab-Scenarioset1-1">
        <name value="Scenario 1.1"/>
        <description value="Send a panel of laboratory results in LOINC."/>
        
        <nts:include value="test.client.successfulTransaction" scope="common" 
            sourceId="scenario-1-1-panel-fixture-LOINC"/>
        <nts:include value="assert.request.numResources" scope="common" resource="Specimen" count="1"/>
        <nts:include value="assert.request.numResources" scope="common" resource="Organization" count="2"/>
        <nts:include value="assert.request.numResources" scope="common" resource="Patient" count="1"/>
        <action>
            <assert>
                <description
                    value="Confirm that the Observation resources have a LOINC code in the code element"/>
                <direction value="request"/>
                <expression value="Bundle.entry.resource.as(Observation).where(code.coding.where(system = 'http://loinc.org').exists()).count() = 4"/>
            </assert>
        </action>
<!--        asserts toevoegen om te checken of de observations van de juiste patient worden meegestuurd-->
<!--        de sent wil je afgescheiden houden
        aan het eind van ieder sentscript een teardown te doen om alles wat je gekregen hebt, zo goed mogelijk te verwijderen maar dit is alleen het geval voor -->
    </test>
</TestScript>
