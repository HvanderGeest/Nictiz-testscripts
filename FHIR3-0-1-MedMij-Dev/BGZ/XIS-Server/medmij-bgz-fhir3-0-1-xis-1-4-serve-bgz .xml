<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://hl7.org/fhir/STU3/testscript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<TestScript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir http://hl7.org/fhir/STU3/fhir-all.xsd" xmlns="http://hl7.org/fhir">
    <id value="medmij-bgz-fhir3-0-1-xis-1-4-serve-bgz-xml" />
    <url value="http://nictiz.nl/fhir/fhir3-0-1/TestScript/medmij-bgz-fhir3-0-1-xis-1-4-serve-bgz-xml"/>  
    <name value="Nictiz MedMij BgZ - XIS Server - Scenario 1.4 - Serve BgZ - XML"/>  
    <status value="active"/>  
    <date value="2018-07-30"/>  
    <publisher value="Nictiz"/>  
    <contact> 
        <name value="Nictiz"/>  
        <telecom> 
            <system value="email"/>  
            <value value="kwalificatie@nictiz.nl"/>  
            <use value="work"/> 
        </telecom> 
    </contact>  
    <description value="MedMij BgZ for FHIR STU3 (v3.0.1) - Scenario 1.4: Serve BgZ - XML Format - All BgZ resources of person 2 requested with incorrect syntax/parameters and one request with an incorrect authorization token. Response consists of 1 patient resource and a lot of error HTTP status codes and OperationOutcome resources."/>  
    <copyright value="Â© Nictiz 2018"/>  
    <fixture id="patient-token-fixture">
        <resource>
            <reference value="../_reference/resources/medmij-bgz-fhir3-0-1-Patient-Token-kwalificatie2.xml"/>
        </resource>
    </fixture>
    <fixture id="patient1-fixture"> 
        <resource> 
        	<reference value="../_reference/resources/medmij-bgz-fhir3-0-1-patient-ts-02.xml"/> 
        </resource> 
    </fixture>     
    <profile id="Bundle-profile"> 
        <reference value="http://hl7.org/fhir/StructureDefinition/Bundle"/> 
    </profile>  
    <profile id="OperationOutcome-profile">
        <reference value="http://hl7.org/fhir/StructureDefinition/OperationOutcome"/>
    </profile>
    <variable>
        <name value="patient-token-id"/>
        <expression value="Patient.id"/>
        <sourceId value="patient-token-fixture"/>
    </variable>
    <variable> 
        <name value="patient1-id"/>  
        <expression value="Patient.id"/>
        <sourceId value="patient1-fixture"/> 
    </variable> 
    <variable> 
        <name value="patient-profile"/>  
        <expression value="Patient.meta.profile"/>
        <sourceId value="patient1-fixture"/> 
    </variable> 
		
	<!-- No Setup -->

    <test id="01-ServeBgZ-Patient"> 
        <name value="01-ServeBgZ-Patient"/>  
        <description value="Test XIS server search operation for known Patient resource of person 2 including the patient's general practitioner. The expected response code is 200(OK) and content is a searchset Bundle resource with 1 Patient resource entry, returned in XML format."/>  
        <action> 
            <operation> 
                <type> 
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>  
                    <code value="search"/> 
                </type>  
                <resource value="Patient"/>  
                <description value="XIS Server search operation for known Patient, including the referenced practitioner resource."/>  
                <accept value="xml"/>  
                <contentType value="none" />
                <params value="?_include=Patient:general-practitioner"/> 
                <requestHeader>  <!-- 0..* Each operation can have one or more header elements -->
                    <field value="Authorization"/><!-- 1..1 HTTP header field name: OAuth access token -->
                    <value value="${patient-token-id}"/><!-- 1..1 HTTP headerfield value: UUID4 -->
                </requestHeader>
            </operation> 
        </action>        
        <action> 
            <assert> 
                <description value="Confirm that the returned HTTP status is 200(OK)."/>  
                <direction value="response"/>  
                <responseCode value="200"/> 
            </assert> 
        </action> 
        <action> 
            <assert> 
                <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>  
                <direction value="response"/>  
                <contentType value="xml"/> 
            </assert> 
        </action>  
        <action> 
            <assert> 
                <description value="Confirm that the returned resource type is Bundle."/>  
                <direction value="response"/>  
                <resource value="Bundle"/> 
            </assert> 
        </action> 
        <action> 
            <assert> 
                <description value="Confirm that the returned Bundle type is searchset."/>  
                <direction value="response"/>  
                <expression value="Bundle.type"/>  
                <operator value="equals"/>             
                <value value="searchset"/> 
            </assert> 
        </action>  
        <action> 
            <assert> 
                <description value="Confirm that the returned searchset Bundle contains 1 entries."/>  
                <direction value="response"/>  
                <expression value="Bundle.entry.count() = 1"/>  
            </assert> 
        </action>  
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total." />
                <direction value="response" />
                <expression value="Bundle.total.toInteger() &lt;= entry.count()" />
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the first returned resource cotains a meta.profile tag." />
                <direction value="response" />
                <expression value="Bundle.entry.resource[0].meta.profile.exists() = true" />
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the first returned resource cotains a meta.profile tag matching the expected profile." />
                <direction value="response" />
                <expression value="Bundle.entry.resource[0].meta.profile" />
                <operator value="equals"/>
                <value value="${patient-profile}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the all returned resources contain a meta.profile tag." />
                <direction value="response" />
                <expression value="Bundle.entry.resource.meta.profile.count() = Bundle.entry.resource.count()" />
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag." />
                <direction value="response" />
                <validateProfileId value="Bundle-profile" />
            </assert>
        </action>
    </test> 
   <test id="02-ServeBgZ-Payer">
    <name value="02-ServeBgZ-Payer"/>
    <description value="Test XIS Server search operation for known Coverage resources with an incorrect authorization token. The expected response status code 401 or 404."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Coverage"/>
        <description value="XIS Server search operation for known Coverage resources with an incorrect authorization token."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="wrong-authorization-token"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 401 or 404."/>
        <direction value="response"/>  
        <operator value="in"/>  
        <responseCode value="401,404"/> 
      </assert>
    </action>
  </test>
  <test id="03-ServeBgZ-TreatmentDirective">
    <name value="03-ServeBgZ-TreatmentDirective"/>
    <description value="Test XIS Server search operation for known Consent resource with a category code for TreatmentDirective of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Consent"/>
        <description value="XIS Server search operation for known Consent resources with a SNOMED category code for TreatmentDirective."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="??category==http://snomed.info/sct|11291000146105"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="04-ServeBgZ-AdvanceDirective">
    <name value="04-ServeBgZ-AdvanceDirective"/>
    <description value="Test XIS Server search operation for known Consent resource with a category code for AdvanceDirective of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Consent"/>
        <description value="XIS Server search operation for known Consent resources with a SNOMED category code for AdvanceDirective."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?#categoryhttp://snomed.info/sct|11341000146107"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="05-ServeBgZ-FunctionalOrMentalStatus">
    <name value="05-ServeBgZ-FunctionalOrMentalStatus"/>
    <description value="Test XIS Server search operation for last known Observation resource with a code for FunctionalOrMentalStatus of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for last known Observation resource with a SNOMED code for FunctionalOrMentalStatus."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="/$la3stn?/category=http://snomed.info/sct|118228005,http://snomed.info/sct|384821006"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="06-ServeBgZ-Problem">
    <name value="06-ServeBgZ-Problem"/>
    <description value="Test XIS Server search operation for all known Condition resources of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Condition"/>
        <description value="XIS Server search operation for all known Condition resources."/>
        <accept value="xml"/>
        <contentType value="none"/> 
        <params value="/$"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
      <action>
          <assert>
              <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
              <direction value="response"/>
              <validateProfileId value="OperationOutcome-profile"/>
          </assert>
      </action>
  </test>
  <test id="07-ServeBgZ-LivingSituation">
    <name value="07-ServeBgZ-LivingSituation"/>
    <description value="Test XIS Server search operation for the last known Observation resrouce with a SNOMED code for LivingSituation of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for all known Observation resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?lastn?code=http://snomed.info/sct|365508006"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="08-ServeBgZ-DrugUse">
    <name value="08-ServeBgZ-DrugUse"/>
    <description value="Test XIS Server search operation for all known Observation resrouces with a SNOMED code for DrugUse of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for all known Observation resources with a SNOMED code for DrugUse."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?--"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="09-ServeBgZ-AlcoholUse">
    <name value="09-ServeBgZ-AlcoholUse"/>
    <description value="Test XIS Server search operation for all known Observation resrouces with a SNOMED code for AlcoholUse of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for all known Observation resources with a SNOMED code for AlcoholUse."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="!code&amp;status"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="10-ServeBgZ-TobaccoUse">
    <name value="10-ServeBgZ-TobaccoUse"/>
    <description value="Test XIS Server search operation for all known Observation resrouces with a SNOMED code for TobaccoUse of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for all known Observation resources with a SNOMED code for Tobaccouse."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?=codehttp://snomed.info/sct||365980008"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="11-ServeBgZ-NutritionAdvice">
    <name value="11-ServeBgZ-NutritionAdvice"/>
    <description value="Test XIS Server search operation for all known NutritionOrder resources with an active status of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="NutritionOrder"/>
        <description value="XIS Server search operation for all known NutritionOrder resources with an active status."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value=")status=active"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="12-ServeBgZ-Alert">
    <name value="12-ServeBgZ-Alert"/>
    <description value="Test XIS Server search operation for all Flag resources of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Flag"/>
        <description value="XIS Server search operation for all Flag resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="flag"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="13-ServeBgZ-AllergyIntolerance">
    <name value="13-ServeBgZ-AllergyIntolerance"/>
    <description value="Test XIS Server search operation for all AllergyIntolerance resources of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="AllergyIntolerance"/>
        <description value="XIS Server search operation for all AllergyIntolerance resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?status=activve"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="14-ServeBgZ-MedicationUse">
    <name value="14-ServeBgZ-MedicationUse"/>
    <description value="Test XIS Server search operation for all MedicationStatement resources with a category code for MedicationUse of person 2, including the Medication resource. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="MedicationStatement"/>
        <description value="XIS Server search operation for all MedicationStatement resources with a category code for MedicationUse and include Medication resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?@+3"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="15-ServeBgZ-MedicationAgreement">
    <name value="15-ServeBgZ-MedicationAgreement"/>
    <description value="Test XIS Server search operation for all MedicationRequest resources with a category code for MedicationAgreement of person 2, including the Medication resource. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="MedicationRequest"/>
        <description value="XIS Server search operation for all MedicationRequest resources with a category code for MedicationAgreement and include Medication resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="!_include=Medi]cationRequest:medication"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="16-ServeBgZ-AdministrationAgreement">
    <name value="16-ServeBgZ-AdministrationAgreement"/>
    <description value="Test XIS Server search operation for all MedicationDispense resources with a category code for AdministrationAgreement of person 2, including the Medication resource. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="MedicationDispense"/>
        <description value="XIS Server search operation for all MedicationRequest resources with a category code for MedicationAgreement and include Medication resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?category=http:?//snomed.info/sct|42203d7009&amp;__include=MedicationDispense:medication"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="17-ServeBgZ-MedicalDevice">
    <name value="17-ServeBgZ-MedicalDevice"/>
    <description value="Test XIS Server search operation for all DeviceUseStatement resources of person 2, including Device resources. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="DeviceUseStatement"/>
        <description value="XIS Server search operation for all DeviceUseStatement and include Device resources."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="?_incclude=deviceUseStatement:device"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="18-ServeBgZ-Vaccination">
    <name value="18-ServeBgZ-Vaccination"/>
    <description value="Test XIS Server search operation for all Immunization resources with a completed status of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Immunization"/>
        <description value="XIS Server search operation for all Immunization resources that are completed."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="l?status=notdone"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="19-ServeBgZ-BloodPressure">
    <name value="19-ServeBgZ-BloodPressure"/>
    <description value="Test XIS Server search operation for the last known Obervation resources with a code for BloodPressure of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for the last kown Observation resource with a code for BloodPressure."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="/$code/35354-9"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
  <test id="20-ServeBgZ-BodyWeight">
    <name value="20-ServeBgZ-BodyWeight"/>
    <description value="Test XIS Server search operation for the last known Obervation resources with a code for BodyWeight of person 2. The expected response status code 4xx or 5xx with an OperationOutcome, returned in XML format."/>
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="Observation"/>
        <description value="XIS Server search operation for the last kown Observation resource with a code for BodyWeight."/>
        <accept value="xml"/>
        <contentType value="none"/>
        <params value="/$$lastn?code=http://loinc.org|29463-7"/>
        <requestHeader>
          <!-- 0..* Each operation can have one or more header elements -->
          <field value="Authorization"/>
          <!-- 1..1 HTTP header field name: OAuth access token -->
          <value value="${patient-token-id}"/>
          <!-- 1..1 HTTP headerfield value: UUID4 -->
        </requestHeader>
      </operation>
    </action>
    <action>
      <assert>
        <description value="The expected response status code 4xx or 5xx."/>
        <direction value="response"/>
        <operator value="in"/>  
        <responseCode value="400,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511"/> 
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP Header Content-Type contains the FHIR mime-type 'application/fhir+xml'."/>
        <direction value="response"/>
        <contentType value="xml"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is OperationOutcome."/>
        <direction value="response"/>
        <resource value="OperationOutcome"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned OperationOutcome conforms to the base FHIR specification."/>
        <direction value="response"/>
        <validateProfileId value="OperationOutcome-profile"/>
      </assert>
    </action>
  </test>
</TestScript>