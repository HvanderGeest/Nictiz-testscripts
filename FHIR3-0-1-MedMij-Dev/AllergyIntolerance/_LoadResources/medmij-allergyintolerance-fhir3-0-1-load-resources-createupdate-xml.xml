<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir">
  <id value="medmij-alleryintolerance-fhir3-0-1-load-resources-createupdate-xml"/>
  <url value="http://nictiz.nl/fhir/fhir3-0-1/TestScript/medmij-allergyintolerance-fhir3-0-1-load-resources-createupdate-xml"/>
  <name value="Nictiz MedMij AllergyIntolerance - Load Test Resources - Create Update - XML"/>
  <status value="active"/>
  <date value="2018-07-23"/>
  <publisher value="Nictiz"/>
  <contact>
    <name value="Nictiz"/>
    <telecom>
      <system value="email"/>
      <value value="kwalificatie@nictiz.nl"/>
      <use value="work"/>
    </telecom>
  </contact>
  <description value="[OPTIONAL] Load (create) MedMij Allergy and Intolerance test resources using the update (PUT) operation of the target FHIR server for use in qualification testing. All resource ids are pre-defined. The target XIS FHIR server is expected to support resource create via the update (PUT) operation for client assigned ids."/>
  <copyright value="Â© Nictiz 2018"/>
  <fixture id="patient1-fixture">
    <resource>
      <reference value="../_reference/resources/medmij-allergyintolerance-fhir3-0-1-Patient-kwalificatie1.xml"/>
    </resource>
  </fixture>
  <fixture id="patient1-token-fixture">
    <resource>
      <reference value="/_reference/resources/medmij-allergyintolerance-fhir3-0-1-Patient-Token-kwalificatie1.xml"/>
    </resource>
  </fixture>
  <fixture id="allergyintolerance1-fixture">
    <resource>
      <reference value="../_reference/resources/medmij-allergyintolerance-fhir3-0-1-allergyintolerance1-beevenom.xml"/>
    </resource>
  </fixture>
  <fixture id="allergyintolerance2-fixture">
    <resource>
      <reference value="../_reference/resources/medmij-allergyintolerance-fhir3-0-1-allergyintolerance2-peanut.xml"/>
    </resource>
  </fixture>
  <variable>
    <name value="patient1-id"/>
    <expression value="Patient.id"/>
    <sourceId value="patient1-fixture"/>
  </variable>
  <variable>
    <name value="patient1-token-id"/>
    <expression value="Patient.id"/>
    <sourceId value="patient1-token-fixture"/>
  </variable>
  <variable>
    <name value="allergyintolerance1-id"/>
    <expression value="AllergyIntolerance.id"/>
    <sourceId value="allergyintolerance1-fixture"/>
  </variable>
 <variable>
    <name value="allergyintolerance2-id"/>
    <expression value="AllergyIntolerance.id"/>
    <sourceId value="allergyintolerance2-fixture"/>
  </variable>
  <!-- No Setup -->
  <test id="Step1-LoadTestResourceCreate">
    <name value="Step1-LoadTestResourceCreate"/>
    <description value="[OPTIONAL] Load (create) MedMij AllergyIntolerance test resources using the update (PUT) operation of the target FHIR server for use in qualification testing."/>
    <!-- create patient1 -->
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="updateCreate"/>
        </type>
        <resource value="Patient"/>
        <accept value="xml"/>
        <contentType value="xml"/>
        <params value="/${patient1-id}"/>
        <requestHeader>  
          <field value="Authorization"/>
          <value value="${patient1-token-id}"/>
        </requestHeader>
        <sourceId value="patient1-fixture"/>
      </operation>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
        <operator value="in"/>
        <responseCode value="200,201"/>
      </assert>
    </action>
    <!-- create allergyintolerance1 -->
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="updateCreate"/>
        </type>
        <resource value="AllergyIntolerance"/>
        <accept value="xml"/>
        <contentType value="xml"/>
        <params value="/${allergyintolerance1-id}"/>
        <requestHeader> 
          <field value="Authorization"/>
          <value value="${patient1-token-id}"/>
        </requestHeader>
        <sourceId value="allergyintolerance1-fixture"/>
      </operation>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
        <operator value="in"/>
        <responseCode value="200,201"/>
      </assert>
    </action>
    <!-- create allergyintolerance2 -->
    <action>
      <operation>
        <type>
          <system value="http://hl7.org/fhir/testscript-operation-codes"/>
          <code value="updateCreate"/>
        </type>
        <resource value="AllergyIntolerance"/>
        <accept value="xml"/>
        <contentType value="xml"/>
        <params value="/${allergyintolerance2-id}"/>
        <requestHeader> 
          <field value="Authorization"/>
          <value value="${patient1-token-id}"/>
        </requestHeader>
        <sourceId value="allergyintolerance2-fixture"/>
      </operation>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
        <operator value="in"/>
        <responseCode value="200,201"/>
      </assert>
    </action>
  </test>
</TestScript>

