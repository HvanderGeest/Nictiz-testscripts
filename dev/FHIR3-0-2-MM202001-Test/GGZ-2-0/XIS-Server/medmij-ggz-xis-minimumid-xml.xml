<?xml version="1.0" encoding="UTF-8"?>

<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">  
    <id value="xis-1-1-serve-ggz-xml"/>  
    <meta> 
        <profile value="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript"/> 
    </meta>  
    <url value="http://nictiz.nl/fhir/TestScript/xis-1-1-serve-ggz-xml-xml"/>  
    <version value="stu3-2.0- patchlevel 2021-07- patchlevel 2021-07"/>  
    <name value="BgGGZ - XIS Server - Scenario 1.1 - Serve all GGZ resources of person 1 - XML Format"/>  
    <publisher value="Nictiz"/>  
    <contact> 
        <name value="Nictiz"/>  
        <telecom> 
            <system value="email"/>  
            <value value="kwalificatie@nictiz.nl"/>  
            <use value="work"/> 
        </telecom> 
    </contact>  
    <description value="Scenario 1.1 - Serve all GGZ information of person 1"/>  
    <origin> 
        <index value="1"/>  
        <profile> 
            <system value="http://hl7.org/fhir/testscript-profile-origin-types"/>  
            <code value="FHIR-Client"/> 
        </profile> 
    </origin>  
    <destination> 
        <index value="1"/>  
        <profile> 
            <system value="http://hl7.org/fhir/testscript-profile-destination-types"/>  
            <code value="FHIR-Server"/> 
        </profile> 
    </destination>  
    <fixture id="minimum-Patient-address"> 
        <resource> 
            <reference value="../_reference/resources/minimum-Patient-address.xml"/> 
        </resource> 
    </fixture>  
    <fixture id="minimum-Patient-address2"> 
        <resource> 
            <reference value="../_reference/resources/minimum-Patient-address2.xml"/> 
        </resource> 
    </fixture>  
    <profile id="Bundle-profile"> 
        <reference value="http://hl7.org/fhir/StructureDefinition/Bundle"/> 
    </profile>  
    <variable> 
        <name value="patient-token-id"/>  
        <defaultValue value="Bearer 6fc70c51-bdda-422e-9eaa-899fe24c4ef9"/>  
        <description value="OAuth Token for current patient"/> 
    </variable>  
    <variable> 
        <name value="MedMij-Request-ID"/>  
        <defaultValue value="${UUID}"/>  
        <description value="MedMij-Request-ID, by default a UUID. Does not have to be edited, see MM-2254 for more information"/> 
    </variable>  
    <test id="01-serve-Patient"> 
        <name value="Scenario 1.1 - Patient"/>  
        <description value="Serve Patient resource including the patient's general practitioner for HCIM Patient"/>  
        <action> 
            <operation> 
                <type> 
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>  
                    <code value="search"/> 
                </type>  
                <resource value="Patient"/>  
                <description value="Test XIS server to serve Patient resources."/>  
                <accept value="xml"/>  
                <destination value="1"/>  
                <origin value="1"/>  
                <params value="?_include=Patient:general-practitioner"/>  
                <requestHeader> 
                    <field value="Authorization"/>  
                    <value value="${patient-token-id}"/> 
                </requestHeader>  
                <requestHeader> 
                    <field value="MedMij-Request-ID"/>  
                    <value value="${MedMij-Request-ID}"/> 
                </requestHeader> 
            </operation> 
        </action>  
        <action> 
            <assert> 
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="false"/> 
                </extension>  
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="true"/> 
                </extension>  
                <description value="Confirm that the operation was succesful"/>  
                <operator value="in"/>  
                <responseCode value="200,201"/> 
            </assert> 
        </action>  
        <action> 
            <assert> 
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="false"/> 
                </extension>  
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="false"/> 
                </extension>  
                <description value="Confirm that the returned searchset Bundle contains 1 Patient resource(s). "/>  
                <direction value="response"/>  
                <expression value="Bundle.entry.where(resource.is(Patient)).count() = 1"/>  
                <warningOnly value="false"/> 
            </assert> 
        </action>  
        <!--<action>
            <assert>
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
                    <valueBoolean value="false"/>
                </extension>
                <description value="Confirm that the returned searchset Bundle contains 1 Practitioner resource(s). "/>
                <direction value="response"/>
                <expression value="Bundle.entry.where(resource.is(Practitioner)).count() = 1"/>
                <warningOnly value="false"/>
            </assert>
        </action>-->  
        <action> 
            <assert> 
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="false"/> 
                </extension>  
                <minimumId value="minimum-Patient-address"/> 
            </assert> 
        </action>  
        <action> 
            <assert> 
                <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail"> 
                    <valueBoolean value="false"/> 
                </extension>  
                <minimumId value="minimum-Patient-address2"/> 
            </assert> 
        </action> 
    </test> 
</TestScript>