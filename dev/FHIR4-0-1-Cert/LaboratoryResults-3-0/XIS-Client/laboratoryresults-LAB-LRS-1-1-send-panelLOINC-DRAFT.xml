<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="xis-1-1-send-panel"/>
   <meta>
      <profile value="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript"/>
   </meta>
   <url value="http://nictiz.nl/fhir/TestScript/xis-1-1-send-panel"/>
   <version value="R4-3.0-patchlevel 2022-08"/>
   <name value="LaboratoryResults - LAB-LRS - Scenario 1.1 - Send a panel of laboratory results in LOINC."/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="Scenario 1.1 - Send a panel of laboratory results in LOINC."/>
   <origin>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <fixture id="scenario-1-1-panel-fixture-LOINC">
      <autocreate value="false"/>
      <autodelete value="false"/>
      <resource>
         <reference value="../_reference/lr-slr-KWAL-KC-LOINC-Scenario1-KCLOINC1.xml"/>
      </resource>
   </fixture>
   <test id="lab-Scenarioset1-1">
      <name value="Scenario 1.1"/>
      <description value="Send a panel of laboratory results in LOINC."/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the Observation resources have a LOINC code in the code element"/>
            <direction value="request"/>
            <expression value="Bundle.entry.resource.as(Observation).where(code.coding.where(system = 'http://loinc.org').exists()).count() = 4"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!--        asserts toevoegen om te checken of de observations van de juiste patient worden meegestuurd-->
      <!--        de sent wil je afgescheiden houden
        aan het eind van ieder sentscript een teardown te doen om alles wat je gekregen hebt, zo goed mogelijk te verwijderen maar dit is alleen het geval voor -->
   </test>
</TestScript>
